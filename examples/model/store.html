
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Storing a model in a (relational) Database - Joerg Viola</title>
  <meta name="author" content="Joerg Viola">

  
  <meta name="description" content="Storing a Model in a (Relational) Database Scala In scala, a model is typically implemented as a case class: BlogEntry.scala
1
2
3
case class &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://joergviola.github.com/examples/model/store.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Joerg Viola" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-15836168-8']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">
  	<img src="/images/logo.png" height="100px" style="vertical-align:middle">
  	Joerg Viola
  </a></h1>
  
    <h2>Lean. Web. Development.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:joergviola.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/examples">Play By Examples</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Storing a Model in a (Relational) Database</h1>
    
  </header>
  
  <h2>Scala</h2>

<p>In scala, a model is typically implemented as a case class:</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/models/BlogEntry.scala'>BlogEntry.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">BlogEntry</span><span class="o">(</span>
</span><span class='line'>  <span class="n">subject</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
</span><span class='line'>  <span class="n">text</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>One way of implementing persistence is using
<a href="http://slick.typesafe.com">Typesafe Slick</a>.
In order to get a driver-independent mapping of RDBMS tuples to
instances of the model, a DAO class is created with the driver as an
argument.</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/models/BlogEntry.scala'>BlogEntry.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">class</span> <span class="nc">BlogEntryDAO</span><span class="o">(</span><span class="k">val</span> <span class="n">driver</span><span class="k">:</span> <span class="kt">ExtendedProfile</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">driver.simple._</span>
</span><span class='line'>  <span class="k">object</span> <span class="nc">BlogEntries</span> <span class="k">extends</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">BlogEntry</span><span class="o">](</span><span class="s">&quot;BLOG_ENTRY&quot;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">subject</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;SUBJECT&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">text</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;TEXT&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">def</span> <span class="o">*</span> <span class="k">=</span> <span class="n">subject</span> <span class="o">~</span> <span class="n">text</span> <span class="o">&lt;&gt;</span> <span class="o">(</span><span class="nc">BlogEntry</span><span class="o">,</span> <span class="nc">BlogEntry</span><span class="o">.</span><span class="n">unapply</span> <span class="n">_</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then the drivers Table trait is imported.</p>

<p>Eventually, the mapping is defined</p>

<ul>
<li>in terms of the columns and their types and names and</li>
<li>a projection named &#8216;*&#8217; concatenating the columns and a compose/decompose
pair of functions.</li>
</ul>


<p>In order to be able to access the database, the following trait can then be used.
It reads the currently defined database driver from the configuration and maps
it to the corresponding Slick driver class:</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/controllers/Persistent.scala'>Persistent.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">trait</span> <span class="nc">Persistent</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">driverClass</span> <span class="k">=</span> <span class="nc">Configuration</span><span class="o">.</span><span class="n">root</span><span class="o">().</span><span class="n">getString</span><span class="o">(</span><span class="s">&quot;db.default.driver&quot;</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s">&quot;org.h2.Driver&quot;</span> <span class="k">=&gt;</span> <span class="s">&quot;scala.slick.driver.H2Driver&quot;</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This class is then instantiated. (A Scala object <code>X</code> is available as class <code>X$</code>
in the Java world and has a field <code>MODULE$</code> that holds its class at runtime.)</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/controllers/Persistent.scala'>Persistent.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">val</span> <span class="n">driver</span> <span class="k">=</span> <span class="n">singleton</span><span class="o">[</span><span class="kt">ExtendedProfile</span><span class="o">](</span><span class="n">driverClass</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="k">def</span> <span class="n">singleton</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">man</span><span class="k">:</span> <span class="kt">Manifest</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=</span>
</span><span class='line'>    <span class="nc">Class</span><span class="o">.</span><span class="n">forName</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;$&quot;</span><span class="o">).</span><span class="n">getField</span><span class="o">(</span><span class="s">&quot;MODULE$&quot;</span><span class="o">).</span><span class="n">get</span><span class="o">(</span><span class="n">man</span><span class="o">.</span><span class="n">runtimeClass</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then for access from outside, all DAOs of the project are instantiated using the driver:</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/controllers/Persistent.scala'>Persistent.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="n">blogEntries</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">BlogEntryDAO</span><span class="o">(</span><span class="n">driver</span><span class="o">).</span><span class="nc">BlogEntries</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next the actual DB to be used is read from the configuration as a datasource
and then translated to a Slick Database:</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/controllers/Persistent.scala'>Persistent.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">lazy</span> <span class="k">val</span> <span class="n">db</span> <span class="k">=</span> <span class="nc">Database</span><span class="o">.</span><span class="n">forDataSource</span><span class="o">(</span><span class="nc">DB</span><span class="o">.</span><span class="n">getDataSource</span><span class="o">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we are able to define a controller <code>Action</code> that is running in a slick
transaction context:</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/controllers/Persistent.scala'>Persistent.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">def</span> <span class="nc">TransAction</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">Request</span><span class="o">[</span><span class="kt">AnyContent</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nc">SlickSession</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Result</span><span class="o">)</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">AnyContent</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="nc">Action</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">session</span> <span class="k">=</span> <span class="n">db</span><span class="o">.</span><span class="n">createSession</span>
</span><span class='line'>      <span class="n">session</span> <span class="n">withTransaction</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">f</span><span class="o">(</span><span class="n">request</span><span class="o">)(</span><span class="n">session</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the controller, the <code>TransAction</code> can simply be used as follows:</p>

<figure class='code'><figcaption><a href='https://github.com/joergviola/play-by-example/tree/master//model/model-scala/app/controllers/Application.scala'>Application.scala</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">package</span> <span class="nn">controllers</span>
</span><span class='line'>
</span><span class='line'><span class="k">import</span> <span class="nn">play.api._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">play.api.mvc._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">models.BlogEntry</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="k">with</span> <span class="nc">Persistent</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">index</span> <span class="k">=</span> <span class="nc">TransAction</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="k">implicit</span> <span class="n">session</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">import</span> <span class="nn">driver.simple._</span>
</span><span class='line'>      <span class="n">blogEntries</span><span class="o">.</span><span class="n">insert</span><span class="o">(</span><span class="nc">BlogEntry</span><span class="o">(</span><span class="s">&quot;s1&quot;</span><span class="o">,</span> <span class="s">&quot;t1&quot;</span><span class="o">))</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">entries</span> <span class="k">=</span> <span class="k">for</span> <span class="o">(</span><span class="n">b</span> <span class="k">&lt;-</span> <span class="n">blogEntries</span><span class="o">)</span> <span class="k">yield</span> <span class="n">b</span>
</span><span class='line'>      <span class="nc">Ok</span><span class="o">(</span><span class="n">views</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">index</span><span class="o">(</span><span class="s">&quot;Your new application is ready.&quot;</span><span class="o">,</span> <span class="n">entries</span><span class="o">.</span><span class="n">list</span><span class="o">))</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Moreover, a simple <code>session.rollback</code> or throwing an exception would
rollback the transaction.</p>

<h2>Java</h2>

<p>To be written.</p>

  
    <footer>
      
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://joergviola.github.com/examples/model/store.html" data-via="joergviola" data-counturl="http://joergviola.github.com/examples/model/store.html" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Play by Examples</h1>
  <ol>
	<li><a href="/examples/introduction">The first example</a></li>
  <!--
	<li><a href="/controller.html">HTTP Controllers</a></li>
	<li><a href="/view.html">Template Programming</a></li>
  -->
	<li><a href="/examples/model">Database Access</a></li>
  <!--
	<li><a href="/forms.html">Form Posting</a></li>
	<li><a href="/apis.html">JSON and XML</a></li>
	<li><a href="/file.html">File Upload</a></li>
	<li><a href="/reactive.html">Reactive Programming</a></li>
	<li><a href="/akka.html">Akka</a></li>
	<li><a href="/global.html">Startup and Filters</a></li>
	<li><a href="/modules.html">Plugins and Modules</a></li>
	<li><a href="/testing.html">Testing</a></li>
	<li><a href="/security.html">Security</a></li>
  -->
  </ol>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Joerg Viola -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'joergviola-github';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://joergviola.github.com/examples/model/store.html';
        var disqus_url = 'http://joergviola.github.com/examples/model/store.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
